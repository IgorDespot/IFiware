version: "2"

networks:
  fiware:
    external: true

services:
  mongodb:
    image: mongo:3.4.2
    hostname: mongodb
    container_name: mongodb
    ports:
      - "27017:27017"
    expose:
      - "27017"
    volumes:
      - mongodb-volume:/data
    command: mongod --smallfiles
    networks:
      - fiware

  orion:
    image: fiware/orion:latest
    hostname: orion
    container_name: orion
    links:
      - mongodb
    expose:
      - "1026"
    ports:
      - "1026:1026"
    command: -dbhost mongodb
    networks:
      - fiware

  cygnus:
    image: fiware/cygnus-ngsi:latest
    hostname: cygnus
    container_name: cygnus
    volumes:
      - "./config/cygnus/agent.conf:/opt/apache-flume/conf/agent.conf:rw"
    links:
      - orion
      - postgres-cygnus
    expose:
      - "5050"
      - "8081"
    ports:
      - "5050:5050"
      - "8081:8081"
    environment:
      - CYGNUS_POSTGRES_USER=fiware
      - CYGNUS_POSTGRES_DB=fiware
      - CYGNUS_POSTGRES_PASSWORD=fiware
    networks:
      - fiware

  postgres-cygnus:
    restart: always
    image: postgres:9.5
    hostname: postgres-cygnus
    container_name: postgres-cygnus
    expose:
      - "5432"
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=fiware
      - POSTGRES_DB=fiware
      - POSTGRES_PASSWORD=fiware
    volumes:
      - postgres-cygnus-volume:/var/lib/postgres
    networks:
      - fiware

volumes:
  mongodb-volume:
  postgres-cygnus-volume: